---
title:  "DuomenÅ³ tinkamumo patvirtinimo / redagavimo / Ä¯raÅ¡ymo Å¾iniÅ³ vidiniai mokymai (IV)"
author: "Lietuvos Statistika"
output: 
   learnr::tutorial:
       theme: "cerulean"
       language: 
        en:
         button:
           nexttopic: Pirmyn
           previoustopic: Atgal
           runcode: Vykdyti kodÄ…
           hint: UÅ¾uomina
           hint_plural: UÅ¾uominos
           hintnext: Kita uÅ¾uomina
           hintprev: Atgal
           solution: Sprendimas
           copyclipboard: Kopijuoti
           startover: IÅ¡ naujo
           continue: TÄ™sti
           submitanswer: Pateikti atsakymÄ…
           questiontryagain: Bandyti iÅ¡ naujo
         text:
           startover: Perkrauti
           areyousure: Esate tikri, kad norite perkrauti esamÄ… programÄ…?
           youmustcomplete: Turite pabaigti 
           exercise: uÅ¾duotis
           exercise_plural: uÅ¾duotys
           inthissection: Å¡ioje dalyje norÄ—dami tÄ™sti. 
           code: Kodas
           quiz: Klausimas
progressive: true
allow_skip: true
runtime: shiny_prerendered
---


```{r setup, include=FALSE}

r = getOption("repos")
r["CRAN"] = "http://cran.us.r-project.org"
options(repos = r)

# 
# install.packages("rmarkdown")
# install.packages("sortable")
# install.packages("openxlsx")
# install.packages("scales")
# install.packages("readxl")
# install.packages("tidyverse")
# install.packages("remotes")
# install.packages("fdm2id")
# install.packages("plyr")
# install.packages("SeleMix")
# install.packages("vcd")
# install.packages("VIM")
# install.packages("dplyr")
# remotes::install_github("rstudio/gradethis")
# remotes::install_github("rstudio/learnr")


library(learnr)
library(gradethis)
library(rmarkdown)
library(sortable)
library(openxlsx)
library(scales)
library(readxl)
library(tidyverse) 
library(fdm2id)
library(plyr)
library(SeleMix)
library(mice)
library(vcd)
library(VIM)
library(dplyr)
knitr::opts_chunk$set(echo = FALSE)
tutorial_options(
  exercise.checker = gradethis::grade_learnr, 
  exercise.startover = TRUE
)
setwd("~/SwedenStuff/Lietuvos Statistika/LS - 4 skaidres")
# Create objects use throughout tutorial:
# Read in data as `duomenys`

rm(list = ls())

options(scipen = 999)
set.seed(10)

duomenys <- readRDS("Duomenys_irasymui.RData")
duomenys <- subset(duomenys, AMZIUS == 32:38)
ISSL <- unique(duomenys[!is.na(duomenys$ISSILAVINIMAS_KODAS),
                        c("ISSILAVINIMAS_KODAS","ISSILAVINIMAS_PAVADINIMAS")])

duomenys$ISSILAVINIMAS_KODAS_f <- as.factor(duomenys$ISSILAVINIMAS_KODAS)
duomenys$ISSILAVINIMAS_KODAS_imp <- as.factor(duomenys$ISSILAVINIMAS_KODAS)
```

## Ä®Å¾anga
```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/important.jfif")  
```

```{r, echo=FALSE, out.width="10%", fig.align = "center"}
knitr::include_graphics("images/LS_logo.svg")  
```

<br>
Å ioje platformoje rasite mokymÅ³ medÅ¾iagÄ… Lietuvos Statistikos departamento viduje organizuojamiems mokymams, skirtiems tikslinÄ—ms darbuotojÅ³ grupÄ—ms. Vienas pagrindiniÅ³ Å¡iÅ³ mokymÅ³ siekiÅ³ â€“ platinti Lietuvos Statistikos darbuotojÅ³ Å¾inias ir gebÄ—jimus atlikti statistiniÅ³ duomenÅ³ tinkamumo patvirtinimÄ…, redagavimÄ…, praleistÅ³ reikÅ¡miÅ³ Ä¯raÅ¡ymÄ… naudojantis R programavimo kalba.  <br><br> TeorinÄ— mokymÅ³ medÅ¾iaga jau yra parengta skaidriÅ³ pavidalu. Å ioje platformoje turite galimybÄ™ mokytis savarankiÅ¡kai â€“ perÅ¾iÅ«rÄ—ti parengtÄ… mokymÅ³ medÅ¾iagÄ…, atlikti praktines uÅ¾duotis.
<br><br> Ketvirtojoje mokymÅ³ dalyje pateikiama naudinga informacija apie:

- **LoginÄ¯ Ä¯raÅ¡ymo metodÄ…**<br>
- **StatistinÄ¯ Ä¯raÅ¡ymo metodÄ…**, kuris skirstomas Ä¯: <br>
  - **DonorÅ³ Ä¯raÅ¡ymo metodus**: istorinis, atsitiktinis, nuoseklus, hierarchinis ir artimiausio kaimyno Ä¯raÅ¡ymas
  - **ModeliÅ³ Ä¯raÅ¡ymo metodus**: vidurkio, santykio ir regresinis Ä¯raÅ¡ymas
  - **DaugiareikÅ¡mio Ä¯raÅ¡ymo metodus**
- **Ä®raÅ¡ymo kokybÄ—s tikrinimÄ…**
- **Ä®raÅ¡ymo metodo testavimÄ…**
<br>

#### Kaip tai veikia?

Rasite klausimÅ³ su atsakymÅ³ variantais:
```{r quiz0, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Kiek bus 5+5?", 
           answer("15"),
           answer("10", correct = TRUE), 
           answer("11"),
           answer("100"),
           correct = "Atsakymas teisingas!", 
           incorrect = "Atsakymas neteisingas",
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo",
    allow_retry = TRUE
  )
)
```

Rasite klausimÅ³, kuriuose reikalinga iÅ¡rikiuoti atsakymus pagal tam tikrÄ… eilÄ™:

```{r ranking-example, warning=FALSE, echo=FALSE}

question_rank("<br>1. 2+2 <br>
              2. 10+10 <br>
              3. 100-90 <br>
              4. 4*2",
  answer(skales <- c(
    "4",
    "20",
    "10",
    "8"),
  correct = TRUE), correct = "Teisingai!", incorrect = "Bandykite dar kartÄ…!",
  allow_retry = TRUE,
  random_answer_order = TRUE,
  submit_button = "Pateikti",
  options = sortable_options(), 
  try_again_button = "IÅ¡ naujo"
)
```

Taip pat, dirbsite su R, kur programavimo kodas veiks lyg dirbant tiesiogiai programoje. Paspauskite `Ctr+Enter` arba `Vykdyti kodÄ…` mygtukÄ…, kad Ä¯vykdytumÄ—te programÄ…. 

```{r, echo=FALSE, out.width="85%", fig.align = "center"}
knitr::include_graphics("images/code_chunk_key.png")  
```

```{r example1, exercise=TRUE, exercise.lines = 4, exercise.cap = "R kodas"}
2+2
```

Jeigu nerandate tinkamo atsakymo kodo langelyje, galite pasinaudoti `UÅ¾uomina` , arba pasitikrinti atsakymÄ… `Atsakymas` mygtuku. <br><br> NepamirÅ¡kite pateikti atsakymo paspausdami `Pateikti atsakymÄ…` mygtukÄ…, kur gausite iÅ¡samesnÄ¯ komentarÄ… apie savo kodÄ… anglÅ³ kalba. 

```{r, echo=FALSE, out.width="85%", fig.align = "center"}
knitr::include_graphics("images/code_exercise_key.png")  
```

```{r example2, exercise=TRUE, exercise.lines = 3, exercise.cap = "R kodas"}
2+2==5
```

```{r example2-hint}
Ar suma teisinga?
```

```{r example2-solution}
2+2==4
```

```{r example2-check}
gradethis::grade_code()
```

Taip pat, prieÅ¡ pradedant mokymus, svarbu nuspausti mygtukÄ… `Perkrauti` (kaip paÅ¾ymÄ—ta paveikslÄ—lyje). Tai uÅ¾tikrina, kad uÅ¾duotys yra vykdomos nuo pradÅ¾iÅ³. Å Ä¯ mygtukÄ… galite naudoti kaskart, kai norite perkrauti mokymÅ³ medÅ¾iagÄ… ir jÄ… Ä¯vykdyti iÅ¡ naujo. 

```{r, echo=FALSE, out.width="100%", fig.align = "center"}
knitr::include_graphics("images/start_over.png")  
```

#### Iliustracijos
Å i mokymÅ³ platforma iliustruota paveikslÄ—liais, kuriuos galite rasti [Å¡iuo adresu](https://github.com/allisonhorst/stats-illustrations/). Naudojant Å¡ias iliustracijas, cituokite jas taip: â€œArtwork by @allison_horstâ€.

**SÄ—kmÄ—s!**

## 1. Loginis Ä¯raÅ¡ymo metodas

```{r, echo=FALSE, out.width="70%", fig.align = "center"}
knitr::include_graphics("images/imputation.png")  
```

Loginis Ä¯raÅ¡ymo metodas pasiÅ¾ymi tuo, kad vietoj praleistÅ³ ar klaidingÅ³ reikÅ¡miÅ³ Ä¯raÅ¡omos tikslios reikÅ¡mÄ—s, panaudojant respondento pateiktus statistinius duomenis. Loginis Ä¯raÅ¡ymas turi bÅ«ti atliekamas prieÅ¡ taikant visus kitus Ä¯raÅ¡ymo metodus.

#### 1.1. PaÅ¾ymÄ—kite 3 loginio Ä¯raÅ¡ymo privalumus. 

```{r quiz1, warning =FALSE, echo=FALSE}
question_checkbox(
"",
answer("Patikimas, nes trÅ«kstama reikÅ¡mÄ— nustatoma vienareikÅ¡miÅ¡kai.", correct = TRUE),
answer("Ä®raÅ¡ytos reikÅ¡mÄ—s automatiÅ¡kai tenkina visas statistiniÅ³ duomenÅ³ redagavimo taisykles.", correct = TRUE),
answer("Pats paprasÄiausias statistiniÅ³ duomenÅ³ Ä¯raÅ¡ymo metodas.", correct = TRUE),
answer("Taikytinas net kai nÄ—ra pateikti tenkinantys loginius ar aritmetinius sÄ…ryÅ¡ius statistiniai duomenys."),
answer("Nereikia atlikti jokiÅ³ skaiÄiavimÅ³ Ä¯raÅ¡omoms reikÅ¡mÄ—ms gauti."),
answer("Patogus, nes yra nedaug skaiÄiavimÅ³."),
answer("Tinkamas ir kategoriniams statistiniams duomenims, kai surikiavus pagal kiekybinius kintamuosius Ä¯raÅ¡omos kokybinio kintamojo reikÅ¡mÄ—s."),
    random_answer_order = TRUE,
    allow_retry = TRUE,
    try_again = "Bandykite iÅ¡ naujo",
    submit_button = "Pateikti",
    try_again_button = "IÅ¡ naujo",
    correct = "Atsakymas teisingas!", 
    incorrect = "Bandykite dar kartÄ…."
)
```

## 2. Statistinis Ä¯raÅ¡ymo metodas


*Statistinis Ä¯raÅ¡ymo metodas* â€“ toks metodas, kai reikÅ¡mÄ—ms Ä¯raÅ¡yti naudojami papildomi duomenys ir Ä¯vairÅ«s statistiniai metodai.

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/irasymo_metodai.png")  
``` 

#### 2.1. Surikiuokite statistinio Ä¯raÅ¡ymo metodus pagal Å¾emiau pateiktÄ… jÅ³ apibÅ«dinimÅ³ eilÄ™.

```{r ranking-imputation-methods, warning=FALSE, echo=FALSE}

question_rank("<br> 1. Ä®raÅ¡ymo metodai, kai vietoj praleistos arba klaidingos kintamojo reikÅ¡mÄ—s Ä¯raÅ¡oma panaÅ¡aus tiriamosios populiacijos elemento atitinkamo kintamojo reikÅ¡mÄ— arba to paties elemento reikÅ¡mÄ— iÅ¡ ankstesnio tyrimo ar kitÅ³ Å¡altiniÅ³. <br>
              2. Ä®raÅ¡ymo metodai, pagrÄ¯sti tyrimo kintamojo reikÅ¡miÅ³ statistiniais modeliais. <br>
              3. Ä®raÅ¡ymo metodas, kai kiekvienai praleistai reikÅ¡mei, taikomas pasirinktas Ä¯raÅ¡ymo metodas, modeliuojama keletas reikÅ¡miÅ³.",
  answer(skales <- c(
    "DonorÅ³ metodas",
    "ModeliÅ³ metodas",
    "DaugiareikÅ¡mio Ä¯raÅ¡ymo metodas"),
  correct = TRUE), correct = "Teisingai!", incorrect = "Bandykite dar kartÄ…!",
  allow_retry = TRUE,
  random_answer_order = TRUE,
  submit_button = "Pateikti",
  options = sortable_options(), 
  try_again_button = "IÅ¡ naujo"
)
```

## 3. DonorÅ³ metodas

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/donoru.png")  
``` 

### IstoriniÅ³ arba â€Å¡altÅ³â€œ duomenÅ³ Ä¯raÅ¡ymo metodas

*IstoriniÅ³ arba â€Å¡altÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas* [angl. cold deck imputation](https://www.researchgate.net/publication/322160882_Cold_Deck_Imputation_for_Survey_Non-response_Through_Record_Linkage) â€“ metodas, kai vietoj praleistÅ³ ar klaidingÅ³ statistinio tyrimo kintamojo reikÅ¡miÅ³ Ä¯raÅ¡omi ankstesniÅ³ statistiniÅ³ tyrimÅ³ ar kitÅ³ Å¡altiniÅ³ duomenys. Å is Ä¯raÅ¡ymo metodas naudojamas, kai nagrinÄ—jamas kintamasis su ankstesniais duomenimis susijÄ™s labiau, negu su nagrinÄ—jamo statistiniÅ³ duomenÅ³ rinkinio reikÅ¡mÄ—mis

### Atsitiktinis â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymo metodas

*Atsitiktinis â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas* [angl. random hot deck imputation](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3130338/). Remiantis pagalbiniais kategoriniais kintamaisiais, kuriÅ³ reikÅ¡mÄ—s Å¾inomos visiems populiacijos (imties) elementams, sudaromos Ä¯raÅ¡ymo klasÄ—s su vienodomis Å¡iÅ³ kintamÅ³jÅ³ reikÅ¡mÄ—mis. Kiekvienam recipientui donoras parenkamas atsitiktinai, paprastai potencialiÅ³ donorÅ³ iÅ¡rinkimo tikimybÄ—s imamos vienodos.

- Metodas labai paprastas, taÄiau tokiu bÅ«du Ä¯raÅ¡yta reikÅ¡mÄ— neturi sÄ…ryÅ¡io su tikrÄ…ja reikÅ¡me.

### Nuoseklus â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymo metodas

*Nuoseklus â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas* *(angl. sequential hot deck imputation)* â€“ metodas, kai, tam tikru bÅ«du iÅ¡rikiavus duomenÅ³ rinkinÄ¯, recipientui parenkamas tos paÄios Ä¯raÅ¡ymo klasÄ—s donoras, kuris duomenÅ³ rinkinyje eina prieÅ¡ recipientÄ….

- **Metodo privalumai**: patogus, nes yra nedaug skaiÄiavimÅ³. Tinkamas ir kategoriniams statistiniams duomenims, kai surikiavus pagal kiekybinius kintamuosius Ä¯raÅ¡omos kokybinio kintamojo reikÅ¡mÄ—s. 
- **Metodo trÅ«kumas**: gali pasitaikyti daug tokiÅ³ paÄiÅ³ Ä¯raÅ¡ytÅ³ reikÅ¡miÅ³. Taip gali atsitikti dÄ—l maÅ¾o donorÅ³ skaiÄiaus Ä¯raÅ¡ymo klasÄ—je, taip pat tokiu atveju, jei duomenÅ³ rinkinyje vienas po kito eina keli elementai su praleista nagrinÄ—jamo kintamojo reikÅ¡me. To galima iÅ¡vengti. PavyzdÅ¾iui, pataisius Ä¯raÅ¡ymo algoritmÄ…: parenkami keli potencialÅ«s donorai, duomenÅ³ rinkinyje einantys prieÅ¡ recipientÄ…, o tada iÅ¡ jÅ³ atsitiktinai parenkamas vienas, kurio nagrinÄ—jamo kintamojo reikÅ¡mÄ™ naudosime Ä¯raÅ¡ant duomenis.

### Hierarchinis â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymo metodas

*Hierarchinis â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas* *(angl. hierarchical hot deck imputation)* â€“ tai nuoseklaus â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymo metodo apibendrinimas, kai naudojama daug papildomÅ³ kintamÅ³jÅ³ (tuo paÄiu ir daug Ä¯raÅ¡ymo klasiÅ³).

### Artimiausio kaimyno Ä¯raÅ¡ymo metodas

Artimiausio kaimyno Ä¯raÅ¡ymo medotas [angl. nearest-neighbour imputation](https://www.jstatsoft.org/article/view/v074i07) â€“ metodas, kai naudojantis vienu ar keliais papildomais kintamaisiais ir naudojant kokiÄ… nors atstumo funkcijÄ… recipientui randamas donoras su artimiausiomis tÅ³ kintamÅ³jÅ³ reikÅ¡mÄ—mis. <br><br> Optimalus kaimynÅ³ skaiÄius yra 10-15. 

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/nearest_neighbour.gif")  
``` 

#### 3.1. Surikiuokite Å¾emiau pateiktÅ³ statistinio Ä¯raÅ¡ymo metodÅ³ privalumus pagal Å¾emiau pateiktÄ… jÅ³ pavadinimÅ³ eilÄ™.

```{r ranking-donoru-metodas, warning=FALSE, echo=FALSE}

question_rank("<br> 1. Nuoseklus â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas <br>
              2. Artimiausio kaimyno Ä¯raÅ¡ymas <br>
              3. Atsitiktinis â€Å¡iltÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas <br>
              4. IstoriniÅ³ arba â€Å¡altÅ³â€œ duomenÅ³ Ä¯raÅ¡ymas",
  answer(skales <- c(
    "Patogus, nes yra nedaug skaiÄiavimÅ³. Tinkamas ir kategoriniams statistiniams duomenims, kai surikiavus pagal kiekybinius kintamuosius Ä¯raÅ¡omos kokybinio kintamojo reikÅ¡mÄ—s.",
    "Atstumo funkcijÅ³ bÅ«na Ä¯vairiÅ³. Å ias atstumo funkcijas galima sukonstruoti taip, kad bÅ«tÅ³ sunku panaudoti tÄ… patÄ¯ donorÄ… daug kartÅ³, ir taip iÅ¡vengti statistiniÅ³ duomenÅ³ supanaÅ¡Ä—jimo.",
    "Å io Ä¯raÅ¡ymo metodo privalumas â€“ jis labai paprastas, taÄiau tokiu bÅ«du Ä¯raÅ¡yta reikÅ¡mÄ— neturi sÄ…ryÅ¡io su tikrÄ…ja reikÅ¡me.",
    "Patogu naudoti Å¡Ä¯ metodÄ…, nes nereikia atlikti jokiÅ³ skaiÄiavimÅ³ Ä¯raÅ¡omoms reikÅ¡mÄ—ms gauti, taÄiau jis gali bÅ«ti panaudotas tik tais atvejais, kai yra pateikti praÄ—jusiÅ³ statistiniÅ³ tyrimÅ³ duomenys."),
  correct = TRUE), correct = "Teisingai!", incorrect = "Bandykite dar kartÄ…!",
  allow_retry = TRUE,
  random_answer_order = TRUE,
  submit_button = "Pateikti",
  options = sortable_options(), 
  try_again_button = "IÅ¡ naujo"
)
```

#### 3.2. Atlikite artimiausio kaimyno Ä¯raÅ¡ymÄ… duomenÅ³ rinkinio `duomenys` kintamajam `ISSILAVINIMAS_KODAS` naudodami 3 skirtingus pagalbinius kintamuosius. Å½emiau esanÄiame kode pakeiskite `k` artimiausiÅ³ kaimynÅ³ skaiÄiÅ³ iÅ¡ `k=10` Ä¯ `k=15`. <br>

```{r KNN, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE, exercise.timelimit = 30000}
knn_imp <- kNN(duomenys, variable = "ISSILAVINIMAS_KODAS_imp", k = 10,
               dist_var = c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS"))
```

```{r KNN-hint-1}
Pakeiskite k = 10 Ä¯ k = 15.
```

```{r KNN-solution}
knn_imp <- kNN(duomenys, variable = "ISSILAVINIMAS_KODAS_imp", k = 15,
               dist_var = c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS"))

```

```{r KNN-check}
gradethis::grade_code()
```

#### 3.3. Pasinaudokite Å¾emiau esanÄiu kodo langeliu ir suraskite koks iÅ¡silavinimo kodas *3.2.* uÅ¾duotyje artimiausio kaimyno Ä¯raÅ¡ymo metodu buvo priskirtas asmeniui, kurio `ASMENS_ID_NR` yra `395566`? 

*ReikÅ¡mÄ— Ä¯raÅ¡yta naujai sukurtame stulpelyje pavadinimu `ISSILAVINIMAS_KODAS_imp`*
```{r KNN-kodas, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE, exercise.setup = "KNN", exercise.timelimit = 30000}

```

```{r KNN-kodas-hint}
Pasinaudokite filter() funkcija. IeÅ¡kokite stulpelio pavadinimu ISSILAVINIMAS_KODAS_imp 
```

```{r KNN-kodas-solution}
knn_imp %>%
  filter(ASMENS_ID_NR == 395566)
```

```{r KNNquiz, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("", 
           answer("22"),
           answer("6"), 
           answer("12", correct = TRUE),
           answer("8"),
           correct = "Atsakymas teisingas!", 
           incorrect = "Bandykite dar kartÄ…. Galite naudotis Å¡iuo kodu aukÅ¡Äiau esanÄiame R lange: knn_imp %>%
  filter(ASMENS_ID_NR == 395566)",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

PradÅ¾ioje asmens iÅ¡silavinimas, kurio `ASMENS_ID_NR == 395566`, nebuvo nurodytas. Taikant artimiausio kaimyno Ä¯raÅ¡ymo metodÄ…, jam buvo priskirtas iÅ¡silavinimo kodas (jÄ¯ suradote *3.3* uÅ¾duotyje).


#### 3.4. Kokia Å¡io iÅ¡silavinimo kodo reikÅ¡mÄ—? 
```{r issilavinimo-kodo-tikrinimas, exercise=TRUE, exercise.lines = 4, exercise.cap = "R kodas"}
ISSL # ISSL - jau Ä¯raÅ¡yta duomenÅ³ lentelÄ— su unikaliais iÅ¡silavinimo kodais ir jÅ³ pavadinimais. 
```

```{r issilavinimo-kodo-tikrinimas-hint}
PavyzdÅ¾iui, galite naudotis subset() funkcija, kurios pagalba norimas atsakymas bus iÅ¡vestas kaip rezultatas.
```

```{r issilavinimo-kodo-tikrinimas-solution}
subset(ISSL, ISSILAVINIMAS_KODAS == 12)
```

```{r issilavinimo-kodo-reiksme, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("", 
           answer("Specialioji vidurinÄ— mokykla (technikumas)"),
           answer("Nebaigta pradinÄ— mokykla"), 
           answer("PagrindinÄ— mokykla, progimnazija", correct = TRUE),
           answer("Profesinio mokymo Ä¯staiga po vidurinÄ—s mokyklos"),
           answer("Universitetas (bakalauro studijos)"),
           correct = "Atsakymas teisingas!", 
           incorrect = "Bandykite dar kartÄ….",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```


## 4. ModeliÅ³ metodas

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/modeliu.png")  
``` 

### Vidurkio Ä¯raÅ¡ymas
*Vidurkio Ä¯raÅ¡ymas (angl. mean imputation)* â€“ metodas, kai vietoj praleistÅ³ ar klaidingÅ³ tyrimo kintamojo reikÅ¡miÅ³ yra Ä¯raÅ¡omas Å¡io kintamojo elementÅ³ vidurkis. 
Å is Ä¯raÅ¡ymo metodas gali tikti, kai tyrimo kintamojo reikÅ¡mÄ—s yra simetriÅ¡kai pasiskirsÄiusios apie tiriamosios populiacijos vidurkio reikÅ¡mÄ™.

- **Metodo privalumas**: jÄ¯ lengva realizuoti.



#### 4.1. Atliksime **vidurkio Ä¯raÅ¡ymo metodÄ…** praleistoms `Solar.R` reikÅ¡mÄ—ms. Pirmiausia, importuokite pavyzdinÄ¯ duomenÅ³ rinkinÄ¯ `oro_kokybe` ir patikrinkite, ar visos `Solar.R` reikÅ¡mÄ—s yra uÅ¾pildytos, t.y. nÄ—ra trÅ«kstamÅ³ reikÅ¡miÅ³. Å½emiau pateikti 3 skirtingi tikrinimo variantai. 

```{r mean-imputation-1, exercise=TRUE, exercise.lines = 6, exercise.cap = "R kodas"}
oro_kokybe <- airquality
mean(complete.cases(oro_kokybe$____))
unique(oro_kokybe$____)
any(is.na(oro_kokybe$____))
```

```{r mean-imputation-1-hint}
TuÅ¡Äioje vietoje Ä¯veskite kintamojo, kurio trÅ«kstamas reikÅ¡mes norite patikrinti, pavadinimÄ….
```

```{r mean-imputation-1-solution}
oro_kokybe <- airquality
mean(complete.cases(oro_kokybe$Solar.R))
unique(oro_kokybe$Solar.R)
any(is.na(oro_kokybe$Solar.R))
```

```{r mean-imputation-1-check}
gradethis::grade_code()
```

Kadangi atsakymas `[1] 0.9542484`, 95.43% visÅ³ reikÅ¡miÅ³ yra Ä¯raÅ¡ytos, tad dalies - trÅ«ksta. 

Beje, nors Å¡iuo atveju to nedaysime, paprastai vidurkio Ä¯raÅ¡ymÄ… geriausia atlikti tam tikrÅ³ grupiÅ³ viduje. PavyzdÅ¾iui, jeigu Ä¯raÅ¡inÄ—tume vidurkÄ¯ Ä¯moniÅ³ tyrimo duomenims, Ä¯raÅ¡ytume ekonominÄ—s veiklos rÅ«Å¡ies grupÄ—ms (pvz., Å¾emÄ—s Å«kio Ä¯monÄ—ms atskirai Ä¯raÅ¡ytume atitinkamos grupÄ—s vidurkÄ¯).

#### 4.2. Ä® trÅ«kstamÄ… vietÄ… Ä¯raÅ¡ykite vidurkio funkcijÄ… `mean()` (*2 eilutÄ—*). 5-toje eilutÄ—je su funkcija `mean()` taip pat patikrinkite ar trÅ«stamÅ³ reikÅ¡miÅ³ neliko. 6-oje eilutÄ—je su funkcija `unique()` Ä¯vertinkite, ar visos reikÅ¡mÄ—s Ä¯raÅ¡ytos. 7-toje - `any()` Ä¯vertinkite ar liko neÄ¯raÅ¡ytÅ³ reikÅ¡miÅ³. 

```{r mean-imputation-2-setup}
oro_kokybe <- airquality
```

```{r mean-imputation-2, exercise=TRUE, exercise.lines = 7, exercise.cap = "R kodas"}
mean_imputation <- oro_kokybe %>%
  mutate(Solar.R = ifelse(is.na(Solar.R), round(___(Solar.R, na.rm=T), digits = 0), Solar.R))


_____(complete.cases(mean_imputation$Solar.R))
___(mean_imputation$Solar.R)
___(is.na(oro_kokybe$Solar.R))
```

```{r mean-imputation-2-hint}
TuÅ¡Äioje vietoje Ä¯veskite funkcijÅ³ minimÅ³ uÅ¾duotyje pavadinimus, taip kaip 4.1. uÅ¾duotyje.
```

```{r mean-imputation-2-solution}
mean_imputation <- oro_kokybe %>%
  mutate(Solar.R = ifelse(is.na(Solar.R), round(mean(Solar.R, na.rm=T), digits = 0), Solar.R))


mean(complete.cases(mean_imputation$Solar.R))
unique(mean_imputation$Solar.R)
any(is.na(oro_kokybe$Solar.R))
```

```{r mean-imputation-2-check}
gradethis::grade_code()
```


Kadangi atsakymas `[1] 1`, vadinasi 100% visÅ³ reikÅ¡miÅ³ yra Ä¯raÅ¡ytos. Norint patikrinti Ä¯raÅ¡ymo kokybÄ™, galite atlikti tolimesnius veiksmus, pvz. tikrinti, ar skirstinys reikÅ¡mingai pakito po Ä¯raÅ¡ymo. KokybÄ—s tikrinimas bus aptartas Å¡iÅ³ mokymÅ³ 6-tame skyriuje. 


### Santykiu pagrÄ¯stas Ä¯raÅ¡ymas

*Santykiu pagrÄ¯stas Ä¯raÅ¡ymas (angl. ratio imputation)* â€“ tai metodas, kai vietoj praleistos ar klaidingos tyrimo kintamojo reikÅ¡mÄ—s yra Ä¯raÅ¡oma reikÅ¡mÄ—, gauta naudojant Å¡io ir papildomo kintamojo reikÅ¡miÅ³ santykÄ¯.

### Regresinis Ä¯raÅ¡ymas

*Regresinis Ä¯raÅ¡ymas (angl. regression imputation)* â€“ metodas, kai Ä¯raÅ¡ymui naudojami regresiniai modeliai.
Tarkime, tyrimo kintamasis yra ğ‘Œ ir turime papildomus kintamuosius $(ğ‘‹_1, â€¦, ğ‘‹_ğ‘ )$. Galima sudaryti tiesinÄ—s regresijos modelÄ¯:
$$ğ‘Œ=ğ‘+ğ‘_1 ğ‘‹_1+â€¦+ğ‘_ğ‘ ğ‘‹_ğ‘+ğ‘’, $$

Norint naudoti regresinÄ¯ Ä¯raÅ¡ymÄ…, reikia turÄ—ti bent vienÄ… papildomÄ… kintamÄ…jÄ¯ (regresoriÅ³), kuris gerai modeliuotÅ³ kintamÄ…jÄ¯ su praleistomis reikÅ¡mÄ—mis. 

#### 4.3. Surikiuokite modeliÅ³ metodÅ³ trÅ«kumus pagal Å¾emiau pateiktÄ… jÅ³ pavadinimÅ³ eilÄ™.
```{r ranking-modeliu-metodas, warning=FALSE, echo=FALSE}

question_rank("<br>1. Vidurkio Ä¯raÅ¡ymas <br>
              2. Regresinis Ä¯raÅ¡ymas <br>
              3. Santykiu pagrÄ¯stas Ä¯raÅ¡ymas",
  answer(skales <- c("Vietoj praleistÅ³ reikÅ¡miÅ³ Ä¯raÅ¡ius atsakiusiÅ³jÅ³ populiacijos (imties) elementÅ³ vidurkÄ¯, gaunama maÅ¾esnÄ— populiacijos (imties) dispersija, negu vien tik atsakiusiÅ³jÅ³ populiacijos (imties) elementÅ³ dispersija. TodÄ—l tikÄ—tina, kad gali bÅ«ti pakeistas tyrimo kintamojo skirstinys.",
    "Å iam metodui pagrindinÄ— kliÅ«tis â€“ rasti tinkamÄ… modelÄ¯. Jei tiesinis modelis netinka, galima taikyti ir netiesinÄ¯.",
    "Å iam metodui reikalinga, kad koreliacija su papildomu kintamuoju, kurio visos reikÅ¡mÄ—s Å¾inomos, bÅ«tÅ³ didelÄ—. Jeigu neturÄ—sime to paties tyrimo praeito laikotarpio duomenÅ³ arba gerai koreliuojanÄio kito papildomo kintamojo, Å¡io Ä¯raÅ¡ymo metodo naudoti negalÄ—sime."), correct = TRUE), correct = "Teisingai!", incorrect = "Bandykite dar kartÄ…!",
  allow_retry = TRUE,
  random_answer_order = TRUE,
  submit_button = "Pateikti",
  options = sortable_options(), 
  try_again_button = "IÅ¡ naujo"
)
```


## 5. DaugiareikÅ¡mio Ä¯raÅ¡ymo metodas

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/daugiareiksmio.png")  
``` 

DaugiareikÅ¡mio Ä¯raÅ¡ymo metodÄ… galima apraÅ¡yti tokiu algoritmu:

1. Taikant pasirinktÄ… atsitiktinio praleistÅ³ reikÅ¡miÅ³ modeliavimo metodÄ… (pvz. stochastinÄ¯ regresinÄ¯ Ä¯raÅ¡ymÄ…), vietoj praleistÅ³ ir klaidingÅ³ tyrimo kintamojo reikÅ¡miÅ³ sumodeliuojamos ir Ä¯raÅ¡omos priskirtos reikÅ¡mÄ—s. Sumodeliavus trÅ«kstamas reikÅ¡mes vienÄ… kartÄ…, gaunamas uÅ¾pildytas statistiniÅ³ duomenÅ³ rinkinys;
2. ProcedÅ«ra pakartojama nepriklausomai ğ‘€ kartÅ³ ir gaunama ğ‘€ uÅ¾pildytÅ³ statistiniÅ³ duomenÅ³ rinkiniÅ³ (pagal literatÅ«rÄ…, pakanka imti ğ‘€=10 ar net maÅ¾iau);
3. Naudojant kiekvienÄ… iÅ¡ Å¡iÅ³ duomenÅ³ rinkiniÅ³, Ä¯prastiniu bÅ«du apskaiÄiuojamas tiriamosios populiacijos nagrinÄ—jamo parametro Ä¯vertis â€“ gaunama ğ‘€ skirtingÅ³ Ä¯verÄiÅ³;
4. Galutinis daugiareikÅ¡mio Ä¯raÅ¡ymo metodu gaunamas parametro Ä¯vertis â€“ Å¡iÅ³ ğ‘€ Ä¯verÄiÅ³ aritmetinis vidurkis.

- **Metodo privalumai** -  ypaÄ naudingas sudÄ—tingÅ³ tyrimÅ³ duomenÅ³ analizei.
- **Metodo trÅ«kumai** - sulaukia kritikos, kai praleistoms reikÅ¡mÄ—ms modeliuoti yra taikoma keletas modeliÅ³, arba kai neatsakymai yra neatsitiktiniai.

#### 5.1. Ä®veskite praleistas ar klaidingas

`ISSILAVINIMAS_KODAS_imp` reikÅ¡mes naudodamiesi daugiareikÅ¡mio Ä¯raÅ¡ymo metodu `mice.impute.polyreg()` funkcija. <br> *(kitus stulpelius galima perÅ¾iÅ«rÄ—ti su rodyklÄ—mis prie pavadinimÅ³)*

```{r daugiareiksmis1-setup}
set.seed(999)
```


```{r daugiareiksmis1, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE, exercise.timelimit = 30000}
polyreg_imp6 <- _____(y = duomenys$_____,
                                    ry = !is.na(duomenys$______),
                                    x = duomenys[,c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS")],
                                    wy = is.na(duomenys$______))
duomenys$ISSILAVINIMAS_KODAS_imp[is.na(duomenys$ISSILAVINIMAS_KODAS_imp)] <- polyreg_imp6
```

```{r daugiareiksmis1-hint-1}
Ar Ä¯vedÄ—te `mice.impute.polyreg()` funkcijÄ… ir kintamojo pavadinimÄ… Ä¯ tuÅ¡Äias vietas? Taip pat, jei neaiÅ¡ki funkcijos sintaksÄ—, pasinaudokite help("mice.impute.polyreg").
```

```{r daugiareiksmis1-hint-2}
polyreg_imp6 <- mice.impute.polyreg(y = duomenys$ISSILAVINIMAS_KODAS_imp,
                                    ry = !is.na(duomenys$ISSILAVINIMAS_KODAS_imp),
                                    x = duomenys[,c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS")],
                                    wy = is.na(duomenys$ISSILAVINIMAS_KODAS_imp))
duomenys$ISSILAVINIMAS_KODAS_imp[is.na(duomenys$ISSILAVINIMAS_KODAS_imp)] <- polyreg_imp6
```

```{r daugiareiksmis1-solution}
polyreg_imp6 <- mice.impute.polyreg(y = duomenys$ISSILAVINIMAS_KODAS_imp,
                                    ry = !is.na(duomenys$ISSILAVINIMAS_KODAS_imp),
                                    x = duomenys[,c("BENDRAS_bdu", "AKTYVUMAS_ID", "AMZIUS")],
                                    wy = is.na(duomenys$ISSILAVINIMAS_KODAS_imp))
duomenys$ISSILAVINIMAS_KODAS_imp[is.na(duomenys$ISSILAVINIMAS_KODAS_imp)] <- polyreg_imp6
```

```{r daugiareiksmis1-check}
gradethis::grade_code()
```

#### 5.2. Pasinaudokite Å¾emiau esanÄiu kodo langeliu ir suraskite koks iÅ¡silavinimo kodas *5.1.* uÅ¾duotyje daugiareikÅ¡mio Ä¯raÅ¡ymo metodu buvo priskirtas asmeniui, kurio `ASMENS_ID_NR` yra `395566`? 
```{r daugiareiksmis2, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE, exercise.timelimit = 30000, exercise.setup = "daugiareiksmis1-hint-2"}

```

```{r daugiareiksmis2-hint}
Pasinaudokite filter() funkcija. IeÅ¡kote stulpelio pavadinimu ISSILAVINIMAS_KODAS_imp
```

```{r daugiareiksmis2-solution}
duomenys %>%
  filter(ASMENS_ID_NR == 395566)
```

```{r daugiareiksmis2-quiz, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("", 
           answer("12"),
           answer("7"), 
           answer("6"),
           answer("3", correct = TRUE),
           correct = "Atsakymas teisingas!", 
           incorrect = "Bandykite dar kartÄ…. Pasinaudokite uÅ¾uomina aukÅ¡Äiau esanÄiame kodo lange.",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

PradÅ¾ioje, asmens iÅ¡silavinimas, kurio `ASMENS_ID_NR == 395566`, nebuvo nurodytas. Taikant daugiareikÅ¡mio Ä¯raÅ¡ymo metodÄ…, jam buvo priskirtas iÅ¡silavinimo kodas (jÄ¯ suradote *5.2* uÅ¾duotyje).

#### 5.3. Kokia Å¡io iÅ¡silavinimo kodo reikÅ¡mÄ—? 

```{r daugiareiksmio-kodo-tikrinimas, exercise=TRUE, exercise.lines = 1, exercise.cap = "R kodas"}
ISSL # ISSL - jau Ä¯raÅ¡yta duomenÅ³ lentelÄ— su unikaliais iÅ¡silavinimo kodais ir jÅ³ pavadinimais. 
```

```{r daugiareiksmio-kodo-tikrinimas-hint}
PavyzdÅ¾iui, galite naudotis subset() funkcija, kurios pagalba rasite koks iÅ¡silavinimo pavadinimas priskirtas asmeniui 5.2. uÅ¾duotyje. 
```

```{r daugiareiksmio-kodo-tikrinimas-solution}
subset(ISSL, ISSILAVINIMAS_KODAS == 3)
```

```{r daugiareiksmio-kodo-reiksme, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("", 
           answer("Specialioji vidurinÄ— mokykla (technikumas)"),
           answer("Nebaigta pradinÄ— mokykla"), 
           answer("Kolegija", correct = TRUE),
           answer("Profesinio mokymo Ä¯staiga po vidurinÄ—s mokyklos"),
           answer("Universitetas (magistrantÅ«ros ir jai prilyginamo)"),
           correct = "Atsakymas teisingas!", 
           incorrect = "Bandykite dar kartÄ….",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

```{r, echo=FALSE, out.width="40%", fig.align = "left"}
knitr::include_graphics("images/monsteRs.jpg")  
```

## 6. KokybÄ—s tikrinimas


```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/data_cowboy.png")  
```

Å½emiau esanÄiu kodu tikrinama, ar reikÅ¡mingai skiriasi kintamÅ³jÅ³ skirstiniai prieÅ¡ ir po praleistÅ³ reikÅ¡miÅ³ Ä¯raÅ¡ymo **daugiareikÅ¡mio Ä¯raÅ¡ymo metodu**.

#### 6.1. AtidÅ¾iai perÅ¾velkite Å¾emiau nurodytÄ… kokybÄ—s tikrinimo kodÄ…. 

```{r kokybes-tikrinimas-1-setup}
polyreg_imp6 <- mice.impute.polyreg(y = duomenys$ISSILAVINIMAS_KODAS_imp,
                                    ry = !is.na(duomenys$ISSILAVINIMAS_KODAS_imp),
                                    x = duomenys[,c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS")],
                                    wy = is.na(duomenys$ISSILAVINIMAS_KODAS_imp))
```

```{r kokybes-tikrinimas-1, exercise=TRUE, exercise.lines = 1, exercise.cap = "R kodas", exercise.lines = 10, exercise.timelimit = 30000}
duomenys$ISSILAVINIMAS_KODAS_imp[is.na(duomenys$ISSILAVINIMAS_KODAS_imp)] <- polyreg_imp6
past <- as.data.frame(table(duomenys$ISSILAVINIMAS_KODAS_f))
past <- data.frame(past, dalis = past$Freq/sum(!is.na(duomenys$ISSILAVINIMAS_KODAS_f)))
poll <- as.data.frame(table(duomenys$ISSILAVINIMAS_KODAS_imp))
df1 <- merge(past, poll, by = "Var1", all = TRUE)
df1[is.na(df1$Freq.y),"Freq.y"] <- 0
chisq.test(x = df1$Freq.y, p = df1$dalis) # p-reikÅ¡mÄ— = 1
```

```{r pries-po-irasymo, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Ar prieÅ¡ ir po **daugiareikÅ¡mio Ä¯raÅ¡ymo metodo** taikymo kintamÅ³jÅ³ skirstiniai skiriasi reikÅ¡mingai  *(chisq.test)* nuo originalaus skirstinio?", 
           answer("Taip"),
           answer("Ne", correct = TRUE),
           correct = "Atsakymas teisingas! P reikÅ¡mÄ— didesnÄ— uÅ¾ daÅ¾nai pasirenkamÄ… 0.05 lygmenÄ¯, vadinasi daugiareikÅ¡mio Ä¯raÅ¡ymo metodas nepadarÄ— didelÄ—s Ä¯takos turimai imÄiai, jÅ³ skirtumas nÄ—ra reikÅ¡mingas.", 
           incorrect = "Bandykite dar kartÄ…. Patikrinkite chi-squared reikÅ¡mÄ™ aukÅ¡Äiau iÅ¡pildytame kode. ",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

Å½emiau esanÄioje dalyje tikrinama, ar reikÅ¡mingai skiriasi kintamÅ³jÅ³ skirstiniai prieÅ¡ ir po praleistÅ³ reikÅ¡miÅ³ Ä¯raÅ¡ymo **artimiausio kaimyno metodu**. 

#### 6.2. AtidÅ¾iai perÅ¾velkite Å¾emiau nurodytÄ… kokybÄ—s tikrinimo kodÄ….

```{r kokybes-tikrinimas-2-setup}
knn_imp <- kNN(duomenys, variable = "ISSILAVINIMAS_KODAS_imp", k = 5,
               dist_var = c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS"))

```

```{r kokybes-tikrinimas-2, exercise=TRUE, exercise.cap = "R kodas", exercise.lines = 10, exercise.timelimit = 30000}

past <- as.data.frame(table(knn_imp$ISSILAVINIMAS_KODAS_f))
past <- data.frame(past, dalis = past$Freq/sum(!is.na(knn_imp$ISSILAVINIMAS_KODAS_f)))
poll <- as.data.frame(table(knn_imp$ISSILAVINIMAS_KODAS_imp))
df2 <- merge(past, poll, by = "Var1", all = TRUE)
df2[is.na(df2$Freq.y),"Freq.y"] <- 0
chisq.test(x = df2$Freq.y, p = df2$dalis) # p-reikÅ¡mÄ— = 1
```

```{r kokybes-tikrinimas-2-solution}
# Daugiareiksmio irasymo metodas kategoriniam kintamajam 
# irasymui naudojamas politomines logistines regresijos modelis, atskiras "mice" atvejis):
polyreg_imp6 <- mice.impute.polyreg(y = duomenys$ISSILAVINIMAS_KODAS_imp,
                                    ry = !is.na(duomenys$ISSILAVINIMAS_KODAS_imp),
                                    x = duomenys[,c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS")],
                                    wy = is.na(duomenys$ISSILAVINIMAS_KODAS_imp))

# ArtimiausiÅ³ kaimynÅ³ metodas (pasirinktas kaimynÅ³ skaiÄius - 5):
knn_imp <- kNN(duomenys, variable = "ISSILAVINIMAS_KODAS_imp", k = 5,
               dist_var = c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS"))



# KOKYBDÄ–S TIKRINIMAS
duomenys$ISSILAVINIMAS_KODAS_imp[is.na(duomenys$ISSILAVINIMAS_KODAS_imp)] <- polyreg_imp6
past <- as.data.frame(table(duomenys$ISSILAVINIMAS_KODAS_f))
past <- data.frame(past, dalis = past$Freq/sum(!is.na(duomenys$ISSILAVINIMAS_KODAS_f)))
poll <- as.data.frame(table(duomenys$ISSILAVINIMAS_KODAS_imp))
df1 <- merge(past, poll, by = "Var1", all = TRUE)
df1[is.na(df1$Freq.y),"Freq.y"] <- 0
chisq.test(x = df1$Freq.y, p = df1$dalis) # p-value = 1


past <- as.data.frame(table(knn_imp$ISSILAVINIMAS_KODAS_f))
past <- data.frame(past, dalis = past$Freq/sum(!is.na(knn_imp$ISSILAVINIMAS_KODAS_f)))
poll <- as.data.frame(table(knn_imp$ISSILAVINIMAS_KODAS_imp))
df2 <- merge(past, poll, by = "Var1", all = TRUE)
df2[is.na(df2$Freq.y),"Freq.y"] <- 0
chisq.test(x = df2$Freq.y, p = df2$dalis) # p-value = 1

```

```{r pries-po-irasymo-2, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Ar prieÅ¡ ir po **artimiausio kaimyno metodo** taikymo kintamÅ³jÅ³ skirstiniai skiriasi reikÅ¡mingai  *(chisq.test)* nuo originalaus skirstinio?", 
           answer("Taip"),
           answer("Ne", correct = TRUE),
           correct = "Atsakymas teisingas! P reikÅ¡mÄ— didesnÄ— uÅ¾ daÅ¾nai pasirenkamÄ… 0.05 lygmenÄ¯, vadinasi daugiareikÅ¡mio Ä¯raÅ¡ymo metodas nepadarÄ— didelÄ—s Ä¯takos turimai imÄiai, jÅ³ skirtumas nÄ—ra reikÅ¡mingas.", 
           incorrect = "Bandykite dar kartÄ…. Patikrinkite chi-squared reikÅ¡mÄ™ aukÅ¡Äiau iÅ¡pildytame kode. ",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

#### 6.3. AtidÅ¾iai perÅ¾velkite Å¾emiau nurodytÄ… kokybÄ—s tikrinimo kodÄ….

```{r kokybes-tikrinimas-3, exercise=TRUE, exercise.cap = "R kodas", exercise.lines = 15, exercise.timelimit = 30000, exercise.setup = "kokybes-tikrinimas-2-solution"}

df <- merge(df1, df2[,c(1,4)], by = "Var1", all.x = TRUE)
df <- merge(df, ISSL, by.x = "Var1", by.y = "ISSILAVINIMAS_KODAS", all.x = TRUE)
df$dalis.y.x <- df$Freq.y.x / (df$Freq.x/df$dalis)
df$dalis.y.y <- df$Freq.y.y / (df$Freq.x/df$dalis)
df <- df[,c(1,6,2,3,4,7,5,8)]
names(df) <- c("kodas", "pav", "kiekis_pries", "dalis_pries", 
               "kiekis_mice", "dalis_mice", "kiekis_knn", "dalis_knn")
df$dalis_pries <- round(df$dalis_pries*100, 2) # asmenÅ³ proc. dalis prieÅ¡ Ä¯raÅ¡ymÄ…
df$dalis_mice <- round(df$dalis_mice*100, 2) # asmenÅ³ proc. dalis po Ä¯raÅ¡ymo su "mice"
df$dalis_knn <- round(df$dalis_knn*100, 2) # asmenÅ³ proc. dalis po Ä¯raÅ¡ymo su "knn_imp"
View(df)
```

```{r pries-po-irasymo-3, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Ar procentÅ³ dalis prieÅ¡ ir po praleistÅ³ ar klaidingÅ³ tyrimo kintamojo reikÅ¡miÅ³ Ä¯raÅ¡ymo turi kuo maÅ¾iau skirtis?", 
           answer("Taip", correct = TRUE),
           answer("Ne"),
           correct = "Atsakymas teisingas! Kuo maÅ¾iau skiriasi, tuo sÄ—kmingesnis Ä¯raÅ¡ymas.", 
           incorrect = "Bandykite dar kartÄ…. Kuo labiau skiriasi, tuo pasirinktas Ä¯raÅ¡ymo metodas labiau paveikÄ— esamÄ… skirstinÄ¯.",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```

#### 6.4. GrafinÄ— kokybÄ—s analizÄ—: perÅ¾iÅ«rÄ—kite ir Ä¯vykdykite kodÄ…, atsakykite Ä¯ klausimus. 

```{r grafine-analize-setup}
knn_imp <- kNN(duomenys, variable = "ISSILAVINIMAS_KODAS_imp", k = 5,
               dist_var = c("BENDRAS_bdu","AKTYVUMAS_ID","AMZIUS"))
duomenys <- knn_imp[,c(1:3,6:8,5,9:11)]
names(duomenys) <- c(head(names(duomenys),-3), "ISSILAVINIMAS_KODAS.x", 
                      "ISSILAVINIMAS_KODAS.y", "ISSILAVINIMAS_KODAS.y_imp")

```

```{r grafine-analize, exercise=TRUE, exercise.lines = 10, exercise.cap = "R kodas", exercise.timelimit = 30000}
educ_po <- sort(table(duomenys$ISSILAVINIMAS_KODAS.y), decreasing = TRUE)
educ_pries <- sort(table(duomenys$ISSILAVINIMAS_KODAS.x[!duomenys$ISSILAVINIMAS_KODAS.y_imp]), decreasing = TRUE)

rbind(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3),
      round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)],
      abs(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3) -
            round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)]))
pav_plot <- round(abs(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3) -
                        round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)]), 2)
pav_plot[pav_plot == 0] <- ""
min_max <- range(c(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3),
                   round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)]))

v <- 1:length(educ_po)
par(mfrow = c(1,1))
plot(v, unname(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3)), 
     xaxt = "n", yaxt = "n", xlab = "ISSILAVINIMAS_KODAS", ylab = "proc. pasiskirstymas", 
     col = "white", main = "IE SILAVINIMAS")
abline(h = round(seq(min_max[1], min_max[2], 1), 2), v = v, col = "gray90", lty = 1, cex = 0.5)
lines(v, unname(round((educ_pries/sum(!duomenys$ISSILAVINIMAS_KODAS.y_imp))*100, 3)), 
      type = "b", lwd = 2, col = "blue")
lines(v, round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)], 
      type = "b", lty = 2, lwd = 2, col = "red")
axis(1, v, names(educ_pries), las = 1, cex.axis = 0.8)
axis(2, round(seq(min_max[1], min_max[2], 0.5), 2), las = 2, cex.axis = 0.8)
text(v, round((educ_po/nrow(duomenys))*100, 3)[names(educ_pries)],
     labels = pav_plot, cex = 0.7, adj = c(-0.5,-0.5), col = "gray50")
legend(x = "topright", legend = c("PrieÅ¡ Ä¯raÅ¡ymÄ…", "Po Ä¯raÅ¡ymo"), 
       lty = 1:2, col = c("blue","red"), lwd = 2) # skaiÄiais paÅ¾ymimi didÅ¾iausi skirtumai

```


```{r grafine-analize-quiz-1, warning =FALSE, echo=FALSE}
question_checkbox(
"Pasinaudokite Å¾emiau esanÄiu kodo langeliu ir paÅ¾ymÄ—kite, kurie 5 iÅ¡silavinimo tipai yra labiausiai paplitÄ™ pagal 6.4. grafikÄ…?",
answer("Universitetas (magistrantÅ«ros ir jai prilyginamos studijos)", correct = TRUE),
answer("VidurinÄ— mokykla, gimnazija", correct = TRUE),
answer("Universitetas (bakalauro studijos)", correct = TRUE),
answer("Kolegija", correct = TRUE),
answer("PagrindinÄ— mokykla, progimnazija", correct = TRUE),
answer("Profesinio mokymo Ä¯staiga po vidurinÄ—s mokyklos"),
answer("Profesinio mokymo Ä¯staiga po pagrindinÄ—s mokyklos"),
answer("AukÅ¡tesnioji mokykla"),
answer("PradinÄ— mokykla"),
answer("Profesinio mokymo Ä¯staiga po pradinÄ—s mokyklos"),
answer("DoktorantÅ«ra"),
    random_answer_order = TRUE,
    allow_retry = TRUE,
    try_again = "Bandykite iÅ¡ naujo",
    submit_button = "Pateikti",
    try_again_button = "IÅ¡ naujo",
    correct = "Atsakymas teisingas!", 
    incorrect = "Bandykite dar kartÄ…."
)
```

```{r ISSL, exercise=TRUE, exercise.lines = 3, exercise.cap = "R kodas"}
# RemkitÄ—s ISSL kodÅ³ lentele.
```

```{r ISSL-hint}
Galite naudotis View() funkcija, kad patikrintumÄ—te kÄ… reikÅ¡ia kiekvienas iÅ¡ iÅ¡silavinimo kodÅ³.
```

```{r ISSL-solution}
View(ISSL)
```

```{r grafine-analize-quiz-2, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Ar procentÅ³ dalis prieÅ¡ ir po praleistÅ³ ar klaidingÅ³/praleistÅ³ tyrimo kintamojo reikÅ¡miÅ³ Ä¯raÅ¡ymo vizualiai pakito?", 
           answer("Taip"),
           answer("Ne", correct = TRUE),
           correct = "Atsakymas teisingas! Kuo maÅ¾iau skiriasi, tuo sÄ—kmingesnis Ä¯raÅ¡ymas.", 
           incorrect = "Bandykite dar kartÄ…. Kuo labiau skiriasi, tuo pasirinktas Ä¯raÅ¡ymo metodas labiau paveikÄ— esamÄ… skirstinÄ¯.",
           allow_retry = TRUE,
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo"
  )
)
```


## 7. Ä®raÅ¡ymo metodo testavimas

#### 7.1. PerÅ¾velkite numanomo duomenÅ³ rinkinio pavyzdÄ¯. 

```{r, echo=FALSE, out.width="65%", fig.align = "left"}
knitr::include_graphics("images/reiksmes_elementai.png")  
```

```{r reiksme-elementai-quiz, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Kiek (viso) aukÅ¡Äiau statistinio tyrimo elementÅ³ paÅ¾ymÄ—ta geltonai?", 
           answer("3"),
           answer("4", correct = TRUE), 
           answer("5"),
           answer("6"),
           correct = "Atsakymas teisingas! Beje, redaguotÅ³ elementÅ³ skaiÄius, iÅ¡ viso, Å¾ymimas simboliu $n_{e}$.", 
           incorrect = "Atsakymas neteisingas.",
  submit_button = "Pateikti", 
  try_again_button = "IÅ¡ naujo",
    allow_retry = TRUE
  ),
  question("Kiek (viso) aukÅ¡Äiau statistinio tyrimo reikÅ¡miÅ³ paÅ¾ymÄ—ta geltonai?", 
           answer("3"),
           answer("4"), 
           answer("5", correct = TRUE),
           answer("6"), 
           correct = "Atsakymas teisingas!  Beje, redaguotÅ³ elementÅ³ skaiÄius, iÅ¡ viso, Å¾ymimas simboliu $n_{r}$", 
           incorrect = "Atsakymas neteisingas.",
           allow_retry = TRUE,
           submit_button = "Pateikti", 
           try_again_button = "IÅ¡ naujo"
  )
)
```

Dabar, prisiminkime **artimiausio kaimyno** Ä¯raÅ¡ymo metodÄ…. DuomenÅ³ rinkinys jau paruoÅ¡tas jo kokybÄ—s tikrinimui ir Å¡io Ä¯raÅ¡ymo metodo testavimui. 

#### 7.2. Pasinaudokite Å¾emiau esanÄiu kodo langeliu ir apskaiÄiuokite **artimiausiÅ³ kaimynÅ³** metodu Ä¯raÅ¡ytÅ³ praleistÅ³ **reikÅ¡miÅ³ dalÄ¯ procentais**. 
*RemkitÄ—s rekomenduojamomis kokybÄ—s rodikliÅ³ formulÄ—mis pateiktomis mokymÅ³ skaidrÄ—se.*

```{r KNN-kokybe, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE, exercise.setup = "KNN", exercise.timelimit = 30000}

```

```{r KNN-kokybe-hint-1}
ApskaiÄiuokite trÅ«kstamÅ³ reikÅ¡miÅ³ skaiÄiÅ³ ISSILAVINIMAS_KODAS stulpelyje. 
```

```{r KNN-kokybe-hint-2}
ReikiamÄ… formulÄ™ rasite mokymÅ³ skaidrÄ—se. SuradÄ™ trÅ«kstamÅ³ reikÅ¡miÅ³ skaiÄiÅ³, apskaiÄiuokite kiek tai sudaro reikÅ¡miÅ³ procentaliai.
```

```{r KNN-kokybe-solution}
proc <- (sum(is.na(duomenys$ISSILAVINIMAS_KODAS))*100)/nrow(duomenys)
proc
```


```{r KNN-kokybe-quiz, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Kokia reikÅ¡miÅ³ dalis procentais Ä¯raÅ¡yta naudojantis artimiausio kaimyno metodu?", 
           answer("12361.28"),
           answer("0.50666136"), 
           answer("0.08283932", correct = TRUE),
           answer("0.82839320"),
           correct = "Atsakymas teisingas! 0.08% visÅ³ reikÅ¡miÅ³ buvo Ä¯raÅ¡yta naudojantis artimiausio kaimyno metodu.", 
           incorrect = "Atsakymas neteisingas. UÅ¾uominoje rasite patarimÄ…, kaip apskaiÄiuoti reikiamÄ… reikÅ¡miÅ³ procentinÄ™ dalÄ¯. Jei nepavyksta, pasinaudokite pateiktu atsakymu ir iÅ¡nagrinÄ—kite, kaip teisinga reikÅ¡mÄ— apskaiÄiuojama.",
           allow_retry = TRUE,
           submit_button = "Pateikti", 
           try_again_button = "IÅ¡ naujo"
  )
)
```

Dabar, prisiminkime **daugiareikÅ¡mio** Ä¯raÅ¡ymo metodÄ….

#### 7.3.  Importuokite duomenÅ³ rinkinÄ¯ ir atlikite **daugiareikÅ¡mio Ä¯raÅ¡ymo metodÄ…** praleistoms reikÅ¡mÄ—ms (1-5 eilutÄ—s). ApskaiÄiuokite, kiek procentaliai **elementÅ³** Ä¯gavo bent po vienÄ… po naujÄ… reikÅ¡mÄ™ (8-9 eilutÄ—s).
*RemkitÄ—s rekomenduojamomis kokybÄ—s rodikliÅ³ formulÄ—mis pateiktomis mokymÅ³ skaidrÄ—se.*

```{r daugiareiksmio-kokybe, exercise=TRUE, exercise.cap = "R kodas", warning=FALSE, echo=FALSE}
_____ <- airquality
imp <- mice(______, print = F)
imputed <- complete(imp)

# redaguotÅ³ statistinio tyrimo elementÅ³ dalis (procentais)
(proc <- (sum(is.na(_____$Ozone) | is.na(_____$Solar.R))*100)/nrow(_____)
)
```

```{r daugiareiksmio-kokybe-hint-1}
Ä® tuÅ¡Äias vietas Ä¯raÅ¡ykite jums tinkantÄ¯ duomenÅ³ rinkinio pavadinimÄ…. ProcentÅ³ daliai apskaiÄiuoti, reikiamÄ… formulÄ™ rasite mokymÅ³ skaidrÄ—se.
```

```{r daugiareiksmio-kokybe-hint-2}
Galite surasti elementÅ³ skaiÄiÅ³, kurie turÄ—jo praleistÄ… reikÅ¡mÄ™ su summary(oro_kokybe). Kadangi praleistos reikÅ¡mÄ—s buvo tik Ozone ir Solar.R stulpeliuose, apskaiÄiuokite kiek tai sudaro viso elementÅ³ procentaliai.
```

```{r daugiareiksmio-kokybe-solution}
oro_kokybe <- airquality
imp <- mice(oro_kokybe, print = F)
imputed <- complete(imp)

# redaguotÅ³ statistinio tyrimo elementÅ³ dalis (procentais)
(proc <- (sum(is.na(oro_kokybe$Ozone) | is.na(oro_kokybe$Solar.R))*100)/nrow(oro_kokybe))
```


```{r daugiareiksmio-kokybe-quiz, warning=FALSE, echo=FALSE}
quiz(caption = "",
  question("Kokia elementÅ³ dalis procentais Ä¯raÅ¡yta naudojantis daugiareikÅ¡mio Ä¯raÅ¡ymo metodu?", 
           answer("1.31"),
           answer("3.06"), 
           answer("64.26"),
           answer("27.45", correct = TRUE),
           correct = "Atsakymas teisingas! 27.45% elementÅ³ gavo bent 1 naujai Ä¯raÅ¡ytÄ… reikÅ¡mÄ™ daugiareikÅ¡mio Ä¯raÅ¡ymo metodu.", 
           incorrect = "Atsakymas neteisingas. UÅ¾uominoje rasite patarimÄ…, kaip apskaiÄiuoti reikiamÄ… elementÅ³ procentinÄ™ dalÄ¯. Jei nepavyksta, pasinaudokite pateiktu atsakymu ir iÅ¡nagrinÄ—kite, kaip tai apskaiÄiuojama.",
           allow_retry = TRUE,
           submit_button = "Pateikti", 
           try_again_button = "IÅ¡ naujo"
  )
)
```

#### 7.4. Surikiuokite statistiniÅ³ duomenÅ³ Ä¯raÅ¡ymo metodo testavimo veiksmus pagal jÅ³ eiliÅ¡kumÄ….

```{r ranking-metodo-testavimass, warning=FALSE, echo=FALSE}

question_rank("",
  answer(skales <- c(
    "Paimti dalÄ¯ statistiniÅ³ duomenÅ³, neturinÄiÅ³ praleistÅ³ ar klaidingÅ³ reikÅ¡miÅ³.",
    "Atsitiktinai parinktas reikÅ¡mes paÅ¡alinti iÅ¡ Å¡io dalinio statistiniÅ³ duomenÅ³ rinkinio.",
    "Pasirinktu statistiniÅ³ duomenÅ³ Ä¯raÅ¡ymo metodu Ä¯raÅ¡yti paÅ¡alintÅ³ reikÅ¡miÅ³ reikÅ¡mes.",
    "Palyginti gautus rezultatus su pradiniu statistiniÅ³ duomenÅ³ rinkiniu. Jei gautas statistiniÅ³ duomenÅ³ rinkinys, palyginus tyrimo kintamÅ³jÅ³ skirstinius, maÅ¾ai skiriasi nuo pradinio â€“ statistiniÅ³ duomenÅ³ Ä¯raÅ¡ymo metodas tinkamas."),
  correct = TRUE), correct = "Teisingai!", incorrect = "Bandykite dar kartÄ…!",
  allow_retry = TRUE,
  random_answer_order = TRUE,
  submit_button = "Pateikti",
  options = sortable_options(), 
  try_again_button = "IÅ¡ naujo"
)
```

```{r, echo=FALSE, out.width="80%", fig.align = "center"}
knitr::include_graphics("images/tidydata_7.jpg")  
```


```{r, echo=FALSE, out.width="10%", fig.align = "right"}
knitr::include_graphics("images/learnr.png")  
```